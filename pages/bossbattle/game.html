<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KrazyPlace â€” Boss battle</title>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
  <style>
    html, body { height: 100%; margin: 0; display: flex; flex-direction: column; }
    main { flex: 1; }
    .hero { padding: 0.5rem; text-align: center; }
    .container-narrow { max-width: 900px; margin: auto; }
    .daily-box { background: var(--surface-2); border-radius: var(--border-radius); padding: 1.5rem; margin-top: 1rem; }

    .troop, .boss {
      background: var(--surface-3);
      border-radius: var(--border-radius);
      padding: 0.5rem;
      margin: 0.5rem;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      width: 150px;
      position: relative;
    }
    .troop:hover { background: var(--surface-1); transform: scale(1.05); }
    .troop.selected {
      border: 3px solid var(--primary);
      box-shadow: 0 0 10px var(--primary);
      background: rgba(0, 120, 255, 0.15);
      transform: scale(1.1);
    }
    .troop.resting {
      opacity: 0.5;
      cursor: not-allowed;
      filter: grayscale(0.7);
    }
    .resting-label {
      position: absolute;
      bottom: 4px;
      right: 6px;
      background: rgba(255, 200, 0, 0.8);
      color: black;
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .rank {
      font-weight: bold;
      padding: 0.2rem 0.5rem;
      border-radius: 0.5rem;
      color: white;
      display: inline-block;
    }
    .rank-F { background: #777; }
    .rank-D { background: #8b5cf6; }
    .rank-C { background: #3b82f6; }
    .rank-B { background: #22c55e; }
    .rank-A { background: #f59e0b; }
    .rank-S { background: #ef4444; animation: pulse 1s infinite alternate; }
    @keyframes pulse { from { box-shadow: 0 0 5px #ef4444; } to { box-shadow: 0 0 20px #ef4444; } }
    footer { text-align: center; margin-top: 1rem; border-top: 1px solid var(--surface-3); padding-top: 1rem; }
  </style>
</head>
<body>
<header class="container container-narrow">
  <nav>
    <ul>
      <li class="logo"><a href="/krazyplace">KrazyPlace</a></li>
      <li><a href="#">Boss battle</a></li>
    </ul>
  </nav>
</header>

<main class="container container-narrow">
  <section class="hero">
    <h1>KrazyPlace â€” Boss Battle</h1>
    <p>Forme ton armÃ©e et terrasse les 5 boss !</p>

    <div style="margin: 1rem 0;">
      <button id="dailyGameBtn">Partie du jour ğŸŒ</button>
      <button id="randomGameBtn">Partie alÃ©atoire ğŸ²</button>
    </div>

    <div class="daily-box" id="gameBox" style="display:none;">
      <h3 id="phaseTitle">Recrutement</h3>
      <div id="gameContent"></div>
    </div>

    <div id="endGame" style="display:none; margin-top:2rem;">
      <h2>ğŸ‰ Fin de partie</h2>
      <p id="finalMessage"></p>
    </div>
  </section>
</main>

<footer><p>Â© KrazyPlace</p></footer>

<script>
function pseudoRandom(seed) {
  let s = seed;
  return () => { s = (s * 16807) % 2147483647; return (s - 1) / 2147483646; };
}

const troopNames = ["Guerrier","Archer","Lancier","Mage","Assassin","Cavalier","Golem","Voleur","Sorcier","Barbare","Moine","Berserker"];
const bossesNames = ["Roi DÃ©mon","Hydre des Sables","Titan de Fer","Dragon des Brumes","Dieu DÃ©chu"];

let rng, army = [], bosses = [], currentBossIndex = 0, selectedTroops = [];

function startGame(seed) {
  rng = pseudoRandom(seed);
  army = [];
  bosses = generateBosses();
  currentBossIndex = 0;
  document.getElementById("gameBox").style.display="block";
  document.getElementById("endGame").style.display="none";
  nextRecruitmentRound();
}

function randomStat() { return Math.floor(20 + rng() * 80); }

function generateTroop() {
  const troop = { name: troopNames[Math.floor(rng()*troopNames.length)], melee: randomStat(), range: randomStat(), speed: randomStat(), resting: 0 };
  troop.rank = getRank(troop);
  return troop;
}

function getRank(t) {
  const total = t.melee+t.range+t.speed;
  if(total>=270) return "S";
  if(total>=240) return "A";
  if(total>=200) return "B";
  if(total>=160) return "C";
  if(total>=120) return "D";
  return "F";
}

function generateBosses() {
  return bossesNames.map(name => ({
    name,
    melee: randomStat()+50,
    range: randomStat()+50,
    speed: randomStat()+50,
    hp: Math.floor(300+rng()*300)
  }));
}

// === Recrutement ===
function nextRecruitmentRound() {
  if(army.length>=10) return startBattlePhase();
  document.getElementById("phaseTitle").textContent = `Recrutement (${army.length}/10)`;
  const choices = [generateTroop(),generateTroop(),generateTroop()];
  renderRecruitChoices(choices);
}

function renderRecruitChoices(choices) {
  const container = document.getElementById("gameContent");
  container.innerHTML="<p>Choisis une troupe :</p>";
  choices.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="troop";
    div.innerHTML=`<strong>${t.name}</strong> <span class="rank rank-${t.rank}">${t.rank}</span><br>âš”ï¸ ${t.melee} | ğŸ¹ ${t.range} | ğŸ’¨ ${t.speed}<br><button onclick="selectTroop(${i}, choices)">Choisir</button>`;
    container.appendChild(div);
  });
}

function selectTroop(i, choices) {
  army.push(choices[i]);
  nextRecruitmentRound();
}

// === Combat ===
function startBattlePhase() {
  selectedTroops=[];
  renderBattleSetup();
  updateSumDisplay();
}

function renderBattleSetup() {
  const container=document.getElementById("gameContent");
  const boss=bosses[currentBossIndex];
  container.innerHTML=`
    <div class="boss"><h3>${boss.name}</h3>â¤ï¸ ${boss.hp} PV<br>âš”ï¸ ${boss.melee} | ğŸ¹ ${boss.range} | ğŸ’¨ ${boss.speed}</div>
    <p>Choisis les troupes Ã  envoyer au combat :</p>
    <p id="sumDisplay" style="font-weight:bold;margin-top:0.5rem;">Aucune troupe sÃ©lectionnÃ©e.</p>
  `;

  let canFight=false;
  army.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="troop";
    if(t.resting>0){ div.classList.add("resting"); div.innerHTML=`<strong>${t.name}</strong> <span class="rank rank-${t.rank}">${t.rank}</span><br>âš”ï¸ ${t.melee} | ğŸ¹ ${t.range} | ğŸ’¨ ${t.speed}<div class="resting-label">Repos (${t.resting})</div>`;}
    else{ canFight=true; if(selectedTroops.includes(i)) div.classList.add("selected"); div.onclick=()=>toggleSelection(i,div); div.innerHTML=`<strong>${t.name}</strong> <span class="rank rank-${t.rank}">${t.rank}</span><br>âš”ï¸ ${t.melee} | ğŸ¹ ${t.range} | ğŸ’¨ ${t.speed}`;}
    container.appendChild(div);
  });

  if(!canFight){ endGame(false,"Toutes les troupes sont en repos !"); return; }

  const btn=document.createElement("button");
  btn.textContent="âš”ï¸ Lancer le combat";
  btn.onclick=launchBattle;
  container.appendChild(btn);
}

function toggleSelection(index, element){
  if(army[index].resting>0) return;
  if(selectedTroops.includes(index)){ selectedTroops=selectedTroops.filter(i=>i!==index); element.classList.remove("selected"); }
  else{ selectedTroops.push(index); element.classList.add("selected"); }
  updateSumDisplay();
}

function updateSumDisplay(){
  const display=document.getElementById("sumDisplay");
  if(!display) return;
  if(selectedTroops.length===0){ display.textContent="Aucune troupe sÃ©lectionnÃ©e."; return; }
  let melee=0,range=0,speed=0;
  selectedTroops.forEach(i=>{ melee+=army[i].melee; range+=army[i].range; speed+=army[i].speed; });
  display.textContent=`âš”ï¸ ${melee} | ğŸ¹ ${range} | ğŸ’¨ ${speed}`;
}

function launchBattle(){
  if(selectedTroops.length===0) return alert("Choisis au moins une troupe !");
  const boss=bosses[currentBossIndex];
  let totalMelee=0,totalRange=0,totalSpeed=0;
  selectedTroops.forEach(i=>{ totalMelee+=army[i].melee; totalRange+=army[i].range; totalSpeed+=army[i].speed; });

  const diffs=[totalMelee-boss.melee,totalRange-boss.range,totalSpeed-boss.speed];
  const damage=diffs.filter(d=>d>0).length>0 ? Math.max(...diffs.filter(d=>d>0)) : 0;
  boss.hp-=damage;

  const container=document.getElementById("gameContent");
  container.innerHTML=`<p>Les troupes infligent ${damage} dÃ©gÃ¢ts au ${boss.name} !</p>`;

  if(boss.hp<=0){
    container.innerHTML+=`<p>ğŸ’¥ ${boss.name} est vaincu !</p>`;
    selectedTroops.forEach(i=>army[i].resting=1); // repos pour 1 combat
    currentBossIndex++;
    if(currentBossIndex>=bosses.length){ endGame(true); }
    else{ container.innerHTML+=`<button onclick="recoverAndNextBoss()">Prochain boss</button>`; }
  } else {
    // troupes envoyÃ©es meurent
    army=army.filter((_,i)=>!selectedTroops.includes(i));
    selectedTroops=[];
    if(army.length===0){ endGame(false,"Toutes les troupes sont mortes !"); return; }
    container.innerHTML+=`<p>Il reste ${boss.hp} PV au boss.</p><button onclick="renderBattleSetup()">Envoyer d'autres troupes</button>`;
  }
}

function recoverAndNextBoss(){
  army.forEach(t=>{ if(t.resting>0) t.resting--; });
  startBattlePhase();
}

function endGame(victory,msg=""){
  document.getElementById("gameBox").style.display="none";
  document.getElementById("endGame").style.display="block";
  document.getElementById("finalMessage").textContent = victory ? "ğŸ† Victoire ! Tu as vaincu les 5 boss !" : "ğŸ’€ DÃ©faite... "+(msg||"ton armÃ©e a Ã©tÃ© anÃ©antie.");
}

document.getElementById("dailyGameBtn").onclick=()=>{
  const today=new Date().toISOString().split("T")[0];
  const seed=today.split("").reduce((a,c)=>a+c.charCodeAt(0),0);
  startGame(seed);
};
document.getElementById("randomGameBtn").onclick=()=>{
  const seed=Math.floor(Math.random()*2147483647);
  startGame(seed);
};
</script>
</body>
</html>
